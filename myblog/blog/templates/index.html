{% extends "base_template.html" %}

{% block title %}
<title>Mini blog site</title>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<div class="card">
  <p>{{ user.first_name|capfirst }}</p>
  <input type"textarea" placeholder="Write something to post"> </input>
</div>
{% endif %}
{% for blog in latest_blogs %}
<div class="justify-content-md-center card text-center p-3 my-3 rounded-5">
    <div class="card-header text-start">
      <a class="link-underline link-underline-opacity-0">
        <strong>{{blog.blogger_name|capfirst}}</strong>
      </a>
        <footer class="fs-6 fw-lighter" title="Source Title"> ({{ blog.post_date }})</footer>
    </div>
    <div class="card-body">
      <h5 class="card-title">{{ blog.title }}</h5>
      <p id="less_{{ forloop.counter }}" class="card-text">{{ blog.description|truncatechars:100 }}</p>
      <p id="more_{{ forloop.counter }}" class="card-text" style="display:none;">{{ blog.description }}</p>
      <button class="btn btn-primary" onclick="readBlog(this, 'more_{{ forloop.counter }}', 'less_{{ forloop.counter }}')" >Read full blog</button>
    </div>
    <div class="card-title text-start ">
        <hr>
        <strong>Comments..</strong>
        <span class="comment-count badge text-bg-danger bg-opacity-100" data-comments-blog-id="{{ blog.id }}">
          {% if blog.comment_set.all %} {{ blog.comment_set.all.count }} {% else %} 0 {% endif %}
        </span>
        <hr>
    </div>
    <div class="comment-section overflow-y-scroll " style="max-height: 200px" data-comments-blog-id="{{ blog.id }}">
    {% if blog.comment_set.all %}
    {% for comment in blog.comment_set.all %}
    <div class="comment text-start" data-comment-id="{{ comment.id }}">
    <a class="btn link-underline link-underline-opacity-0">
      <blockquote class="blockquote text-start p-2 text-light bg-primary bg-gradient bg-opacity-75 m-2 rounded-4 w-auto">
        <p>{{ comment.comment }}</p>
        <footer class="blockquote-footer text-start text-light fs-6 opacity-75">{{ comment.comment_by|capfirst }} <cite title="Source Title">({{ comment.comment_date }})</cite></footer>
    </blockquote>
    </a>
    </div>
    
    {% endfor %}
    {% else %}
    <div>
      <p> No Comments... </p>
    </div>
    {% endif %}
  </div>
  <hr>
  <div >
      {% if user.is_authenticated %}
      <form class="comment-form row g-2" data-blog-id="{{blog.id}}" method="post">
        {% csrf_token %}
        <div class="col-auto form-floating w-75">
          {{ form.comment }}
          {{ form.comment.label_tag }}
        </div>
        <div class="col-auto">
          <button class="rounded-5 m-2" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-4 -4 30 30" width="29" height="29"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"></path><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"></path></svg></button>
        </div>
      </form>
      {% else %}
        <p>Please <a href="{% url "login" %}">Login</a> to add your comments</p>
      {% endif %}
      
  </div>
  </div>
{% endfor %}
{% load static %}
<script src="{% static "javascript/homepage.js" %}" type="text/javascript">
{% endblock %}
